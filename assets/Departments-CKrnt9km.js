import{d as P,r as _,s as G,v as H,o as J,c as w,j as l,g as o,h as r,i as f,b as i,T as K,f as D,t as Q,x as B,u as C,y as W,z as X,p as b,A as Y,F as Z,B as ee,E as u,q as g,C as te,_ as ne}from"./index-L8zpvlSD.js";const le={class:"departments-container"},oe={class:"card-header"},ae={class:"departments-content"},se={class:"tree-node-content"},re={class:"node-actions"},de={class:"dialog-footer"},ie=P({__name:"Departments",setup(ce){const v=_([]),F={children:"children",label:"name"},m=_(),n=G({id:null,name:"",parent_id:null,description:""}),T={name:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:2,max:50,message:"部门名称长度在 2 到 50 个字符",trigger:"blur"}]},c=_(!1),y=_("新增部门"),E=H(()=>{const t=(e,p=null)=>{let s=[];return e.forEach(d=>{d.id!==p&&(s.push(d),d.children&&d.children.length>0&&(s=s.concat(t(d.children,p))))}),s};return t(v.value,n.id)}),k=async()=>{try{console.log("开始请求部门列表...");const t=localStorage.getItem("token");console.log("当前token:",t);const e=await f.get("/api/departments");console.log("获取部门列表成功:",e.data),v.value=e.data}catch(t){console.error("获取部门列表失败:",t),console.error("错误详情:",t.response),console.error("错误状态:",t.response?.status),console.error("错误数据:",t.response?.data)}},N=t=>{console.log("点击节点:",t)},$=(t,e)=>{t.preventDefault(),console.log("右键菜单:",e)},M=()=>{y.value="新增部门",x(),c.value=!0},U=t=>{y.value="编辑部门",n.id=t.id,n.name=t.name,n.parent_id=t.parent_id,n.description=t.description,c.value=!0},z=async t=>{try{await te.confirm(`确定要删除部门 "${t.name}" 吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await f.delete(`/api/departments/${t.id}`),u.success("部门删除成功"),k()}catch(e){e!=="cancel"&&u.error("部门删除失败: "+(e.response?.data?.message||e.message))}},x=()=>{n.id=null,n.name="",n.parent_id=null,n.description="",m.value&&m.value.resetFields()},R=()=>{x()},S=async()=>{try{await m.value.validate(),n.id?(await f.put(`/api/departments/${n.id}`,{name:n.name,parent_id:n.parent_id||null,description:n.description}),u.success("部门更新成功")):(await f.post("/api/departments",{name:n.name,parent_id:n.parent_id||null,description:n.description}),u.success("部门创建成功")),c.value=!1,k()}catch(t){t!=="cancel"&&u.error("操作失败: "+(t.response?.data?.message||t.message))}};return J(()=>{k()}),(t,e)=>{const p=r("el-icon"),s=r("el-button"),d=r("el-tree"),q=r("el-card"),V=r("el-input"),h=r("el-form-item"),A=r("el-option"),j=r("el-select"),I=r("el-form"),L=r("el-dialog");return g(),w("div",le,[l(q,null,{header:o(()=>[i("div",oe,[e[6]||(e[6]=i("span",null,"组织架构",-1)),l(s,{type:"primary",onClick:M},{default:o(()=>[l(p,null,{default:o(()=>[l(C(Y))]),_:1}),e[5]||(e[5]=b(" 新增部门 ",-1))]),_:1})])]),default:o(()=>[i("div",ae,[l(K,{name:"fade",mode:"out-in"},{default:o(()=>[(g(),D(d,{ref:"departmentTree",data:v.value,props:F,"node-key":"id","default-expand-all":"",onNodeClick:N,onNodeContextmenu:$,key:"department-tree-"+Date.now()},{default:o(({data:a})=>[i("div",se,[i("span",null,Q(a.name),1),i("div",re,[l(s,{type:"text",size:"small",onClick:B(O=>U(a),["stop"])},{default:o(()=>[l(p,null,{default:o(()=>[l(C(W))]),_:1})]),_:1},8,["onClick"]),l(s,{type:"text",size:"small",danger:"",onClick:B(O=>z(a),["stop"])},{default:o(()=>[l(p,null,{default:o(()=>[l(C(X))]),_:1})]),_:1},8,["onClick"])])])]),_:1},8,["data"]))]),_:1})])]),_:1}),l(L,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),title:y.value,width:"400px",onClose:R},{footer:o(()=>[i("span",de,[l(s,{onClick:e[3]||(e[3]=a=>c.value=!1)},{default:o(()=>[...e[7]||(e[7]=[b("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:S},{default:o(()=>[...e[8]||(e[8]=[b("保存",-1)])]),_:1})])]),default:o(()=>[l(I,{ref_key:"departmentFormRef",ref:m,model:n,rules:T,"label-position":"top"},{default:o(()=>[l(h,{label:"部门名称",prop:"name"},{default:o(()=>[l(V,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),l(h,{label:"上级部门"},{default:o(()=>[l(j,{modelValue:n.parent_id,"onUpdate:modelValue":e[1]||(e[1]=a=>n.parent_id=a),placeholder:"选择上级部门",clearable:""},{default:o(()=>[(g(!0),w(Z,null,ee(E.value,a=>(g(),D(A,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"部门描述"},{default:o(()=>[l(V,{modelValue:n.description,"onUpdate:modelValue":e[2]||(e[2]=a=>n.description=a),type:"textarea",placeholder:"请输入部门描述",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ue=ne(ie,[["__scopeId","data-v-b459a6d2"]]);export{ue as default};
