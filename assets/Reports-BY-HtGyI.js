import{d as U,r as d,o as Y,c as n,j as a,g as s,h as C,i as f,E as y,M as A,b as e,t as x,u as c,N as m,O as h,p as Z,q as o,_ as $}from"./index-L8zpvlSD.js";import{i as S}from"./index-5QPu3XI4.js";const tt={class:"reports-container"},et={class:"stats-cards"},at={class:"stat-item"},st={class:"stat-value"},lt={class:"stat-item"},nt={class:"stat-value"},ot={class:"stat-item"},rt={class:"stat-value"},it={class:"stat-item"},dt={class:"stat-value"},ct={class:"charts-container"},ut={class:"chart-content"},pt={key:0,class:"loading-container"},vt={key:1},_t={key:2,class:"no-data"},ft={class:"chart-content"},yt={key:0,class:"loading-container"},mt={key:1},ht={key:2,class:"no-data"},gt={class:"chart-content"},bt={key:0,class:"loading-container"},wt={key:1},kt={key:2,class:"no-data"},Ct={class:"chart-content"},xt={key:0,class:"loading-container"},At={key:1},St={key:2,class:"no-data"},Rt={class:"recent-data-container"},Dt={class:"recent-content"},Et={key:0,class:"loading-container"},Ot={key:1},Ft={key:2,class:"no-data"},Bt={class:"recent-content"},Lt={key:0,class:"loading-container"},Mt={key:1},Nt={key:2,class:"no-data"},Tt=U({__name:"Reports",setup(Vt){const u=d(!1),g=d({total_employees:0,total_departments:0,today_attendance:0,pending_leaves:0}),b=d([]),R=d(null);let D=null;const v=d({dates:[],counts:[]}),E=d(null);let O=null;const _=d({male:0,female:0}),F=d(null);let B=null;const w=d([]),L=d(null);let M=null;const N=d([]),T=d([]),W=async()=>{try{const l=await f.get("/api/reports/stats");g.value=l.data.data}catch{y.error("获取统计数据失败")}},z=async()=>{try{const l=await f.get("/api/reports/department-distribution");b.value=l.data.data,await J()}catch{y.error("获取部门分布失败")}},G=async()=>{try{const l=await f.get("/api/reports/attendance-stats");v.value=l.data.data,await I()}catch{y.error("获取考勤统计失败")}},I=async()=>{if(!E.value||!v.value.dates||v.value.dates.length===0)return;await A(),O||(O=S(E.value));const l={title:{text:"最近7天考勤统计",left:"center"},tooltip:{trigger:"axis",formatter:"{b}: {c} 人"},xAxis:{type:"category",data:v.value.dates},yAxis:{type:"value",name:"人数"},series:[{name:"考勤人数",type:"line",data:v.value.counts,smooth:!0,lineStyle:{width:3,color:"#67C23A"},itemStyle:{color:"#67C23A",borderWidth:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(103, 194, 58, 0.3)"},{offset:1,color:"rgba(103, 194, 58, 0.05)"}]}}}]};O.setOption(l)},P=async()=>{try{const l=await f.get("/api/reports/gender-distribution");_.value=l.data.data,await j()}catch{y.error("获取性别分布失败")}},j=async()=>{if(!F.value||!(_.value.male>0||_.value.female>0))return;await A(),B||(B=S(F.value));const l=[{name:"男性",value:_.value.male},{name:"女性",value:_.value.female}],t={title:{text:"员工性别分布",left:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:10,data:["男性","女性"]},series:[{name:"性别",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:l,color:["#409EFF","#F7BA2A"]}]};B.setOption(t)},q=async()=>{try{const l=await f.get("/api/reports/leave-statistics");w.value=l.data.data,await X()}catch{y.error("获取请假类型统计失败")}},X=async()=>{if(!L.value||w.value.length===0)return;await A(),M||(M=S(L.value));const l={annual:"年假",sick:"病假",personal:"事假",other:"其他"},t={title:{text:"请假类型统计",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:"{b}: {c} 天"},xAxis:{type:"category",data:w.value.map(r=>l[r.type]||r.type)},yAxis:{type:"value",name:"天数"},series:[{name:"请假天数",type:"bar",data:w.value.map(r=>r.days),barWidth:"60%",itemStyle:{color:function(r){const i=["#409EFF","#67C23A","#E6A23C","#F56C6C"];return i[r.dataIndex%i.length]},borderRadius:[4,4,0,0]}}]};M.setOption(t)},H=async()=>{try{const l=await f.get("/api/reports/recent");N.value=l.data.data.recent_employees,T.value=l.data.data.pending_leaves}catch{y.error("获取最近数据失败")}},J=async()=>{if(!R.value||b.value.length===0)return;await A(),D||(D=S(R.value));const l={title:{text:"部门员工分布",left:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:b.value.map(t=>t.name)},series:[{name:"部门",type:"pie",radius:"50%",data:b.value.map(t=>({name:t.name,value:t.count})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};D.setOption(l)},K=async()=>{u.value=!0;try{await Promise.all([W(),z(),G(),P(),q(),H()])}catch(l){console.error("获取数据失败:",l)}finally{u.value=!1}};return Y(()=>{K()}),(l,t)=>{const r=C("el-card"),i=C("el-icon"),p=C("el-table-column"),V=C("el-table"),Q=C("el-tag");return o(),n("div",tt,[a(r,null,{header:s(()=>[...t[0]||(t[0]=[e("div",{class:"card-header"},[e("span",null,"数据报表")],-1)])]),default:s(()=>[e("div",et,[a(r,{class:"stat-card"},{default:s(()=>[e("div",at,[t[1]||(t[1]=e("div",{class:"stat-label"},"总员工数",-1)),e("div",st,x(g.value.total_employees||0),1)])]),_:1}),a(r,{class:"stat-card"},{default:s(()=>[e("div",lt,[t[2]||(t[2]=e("div",{class:"stat-label"},"总部门数",-1)),e("div",nt,x(g.value.total_departments||0),1)])]),_:1}),a(r,{class:"stat-card"},{default:s(()=>[e("div",ot,[t[3]||(t[3]=e("div",{class:"stat-label"},"今日考勤",-1)),e("div",rt,x(g.value.today_attendance||0),1)])]),_:1}),a(r,{class:"stat-card"},{default:s(()=>[e("div",it,[t[4]||(t[4]=e("div",{class:"stat-label"},"待审批请假",-1)),e("div",dt,x(g.value.pending_leaves||0),1)])]),_:1})]),e("div",ct,[a(r,{class:"chart-card"},{header:s(()=>[...t[5]||(t[5]=[e("div",{class:"chart-header"},[e("span",null,"部门员工分布")],-1)])]),default:s(()=>[e("div",ut,[u.value?(o(),n("div",pt,[a(i,{class:"loading-icon"},{default:s(()=>[a(c(m))]),_:1}),t[6]||(t[6]=e("span",null,"加载中...",-1))])):b.value.length>0?(o(),n("div",vt,[e("div",{ref_key:"departmentChartRef",ref:R,class:"chart-container"},null,512)])):(o(),n("div",_t,[a(i,null,{default:s(()=>[a(c(h))]),_:1}),t[7]||(t[7]=e("span",null,"暂无数据",-1))]))])]),_:1}),a(r,{class:"chart-card"},{header:s(()=>[...t[8]||(t[8]=[e("div",{class:"chart-header"},[e("span",null,"最近7天考勤统计")],-1)])]),default:s(()=>[e("div",ft,[u.value?(o(),n("div",yt,[a(i,{class:"loading-icon"},{default:s(()=>[a(c(m))]),_:1}),t[9]||(t[9]=e("span",null,"加载中...",-1))])):v.value.dates&&v.value.dates.length>0?(o(),n("div",mt,[e("div",{ref_key:"attendanceChartRef",ref:E,class:"chart-container"},null,512)])):(o(),n("div",ht,[a(i,null,{default:s(()=>[a(c(h))]),_:1}),t[10]||(t[10]=e("span",null,"暂无数据",-1))]))])]),_:1}),a(r,{class:"chart-card"},{header:s(()=>[...t[11]||(t[11]=[e("div",{class:"chart-header"},[e("span",null,"性别分布")],-1)])]),default:s(()=>[e("div",gt,[u.value?(o(),n("div",bt,[a(i,{class:"loading-icon"},{default:s(()=>[a(c(m))]),_:1}),t[12]||(t[12]=e("span",null,"加载中...",-1))])):_.value.male||_.value.female?(o(),n("div",wt,[e("div",{ref_key:"genderChartRef",ref:F,class:"chart-container"},null,512)])):(o(),n("div",kt,[a(i,null,{default:s(()=>[a(c(h))]),_:1}),t[13]||(t[13]=e("span",null,"暂无数据",-1))]))])]),_:1}),a(r,{class:"chart-card"},{header:s(()=>[...t[14]||(t[14]=[e("div",{class:"chart-header"},[e("span",null,"请假类型统计")],-1)])]),default:s(()=>[e("div",Ct,[u.value?(o(),n("div",xt,[a(i,{class:"loading-icon"},{default:s(()=>[a(c(m))]),_:1}),t[15]||(t[15]=e("span",null,"加载中...",-1))])):w.value.length>0?(o(),n("div",At,[e("div",{ref_key:"leaveChartRef",ref:L,class:"chart-container"},null,512)])):(o(),n("div",St,[a(i,null,{default:s(()=>[a(c(h))]),_:1}),t[16]||(t[16]=e("span",null,"暂无数据",-1))]))])]),_:1})]),e("div",Rt,[a(r,{class:"recent-card"},{header:s(()=>[...t[17]||(t[17]=[e("div",{class:"recent-header"},[e("span",null,"最近新增员工")],-1)])]),default:s(()=>[e("div",Dt,[u.value?(o(),n("div",Et,[a(i,{class:"loading-icon"},{default:s(()=>[a(c(m))]),_:1}),t[18]||(t[18]=e("span",null,"加载中...",-1))])):N.value.length>0?(o(),n("div",Ot,[a(V,{data:N.value,border:"",stripe:"",style:{width:"100%"}},{default:s(()=>[a(p,{prop:"name",label:"员工姓名"}),a(p,{prop:"department_name",label:"部门"}),a(p,{prop:"position",label:"职位"}),a(p,{prop:"hire_date",label:"入职日期"})]),_:1},8,["data"])])):(o(),n("div",Ft,[a(i,null,{default:s(()=>[a(c(h))]),_:1}),t[19]||(t[19]=e("span",null,"暂无数据",-1))]))])]),_:1}),a(r,{class:"recent-card"},{header:s(()=>[...t[20]||(t[20]=[e("div",{class:"recent-header"},[e("span",null,"待审批请假")],-1)])]),default:s(()=>[e("div",Bt,[u.value?(o(),n("div",Lt,[a(i,{class:"loading-icon"},{default:s(()=>[a(c(m))]),_:1}),t[21]||(t[21]=e("span",null,"加载中...",-1))])):T.value.length>0?(o(),n("div",Mt,[a(V,{data:T.value,border:"",stripe:"",style:{width:"100%"}},{default:s(()=>[a(p,{prop:"employee_name",label:"员工姓名"}),a(p,{prop:"leave_type",label:"请假类型"},{default:s(k=>[a(Q,{type:k.row.leave_type==="annual"?"primary":k.row.leave_type==="sick"?"warning":"info"},{default:s(()=>[Z(x(k.row.leave_type==="annual"?"年假":k.row.leave_type==="sick"?"病假":k.row.leave_type==="personal"?"事假":"其他"),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"days",label:"天数"}),a(p,{prop:"created_at",label:"申请时间"})]),_:1},8,["data"])])):(o(),n("div",Nt,[a(i,null,{default:s(()=>[a(c(h))]),_:1}),t[22]||(t[22]=e("span",null,"暂无数据",-1))]))])]),_:1})])]),_:1})])}}}),Gt=$(Tt,[["__scopeId","data-v-f00095aa"]]);export{Gt as default};
