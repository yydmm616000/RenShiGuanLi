import{d as j,r as _,n as G,p as H,o as I,c as w,e as l,w as a,f as r,i as f,b as i,t as J,q as D,u as x,s as K,v as Q,l as C,x as W,F as X,y as Y,E as u,m as V,z as Z,A as ee,_ as te}from"./index-BKuDftu-.js";const ne={class:"departments-container"},le={class:"card-header"},ae={class:"departments-content"},oe={class:"tree-node-content"},se={class:"node-actions"},re={class:"dialog-footer"},de=j({__name:"Departments",setup(ie){const v=_([]),B={children:"children",label:"name"},m=_(),t=G({id:null,name:"",parent_id:null,description:""}),F={name:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:2,max:50,message:"部门名称长度在 2 到 50 个字符",trigger:"blur"}]},p=_(!1),g=_("新增部门"),E=H(()=>{const n=(e,c=null)=>{let s=[];return e.forEach(d=>{d.id!==c&&(s.push(d),d.children&&d.children.length>0&&(s=s.concat(n(d.children,c))))}),s};return n(v.value,t.id)}),y=async()=>{try{const n=await f.get("/api/departments");v.value=n.data}catch(n){console.error("获取部门列表失败:",n)}},N=n=>{console.log("点击节点:",n)},$=(n,e)=>{n.preventDefault(),console.log("右键菜单:",e)},M=()=>{g.value="新增部门",b(),p.value=!0},T=n=>{g.value="编辑部门",t.id=n.id,t.name=n.name,t.parent_id=n.parent_id,t.description=n.description,p.value=!0},U=async n=>{try{await ee.confirm(`确定要删除部门 "${n.name}" 吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await f.delete(`/api/departments/${n.id}`),u.success("部门删除成功"),y()}catch(e){e!=="cancel"&&u.error("部门删除失败: "+(e.response?.data?.message||e.message))}},b=()=>{t.id=null,t.name="",t.parent_id=null,t.description="",m.value&&m.value.resetFields()},z=()=>{b()},R=async()=>{try{await m.value.validate(),t.id?(await f.put(`/api/departments/${t.id}`,{name:t.name,parent_id:t.parent_id||null,description:t.description}),u.success("部门更新成功")):(await f.post("/api/departments",{name:t.name,parent_id:t.parent_id||null,description:t.description}),u.success("部门创建成功")),p.value=!1,y()}catch(n){n!=="cancel"&&u.error("操作失败: "+(n.response?.data?.message||n.message))}};return I(()=>{y()}),(n,e)=>{const c=r("el-icon"),s=r("el-button"),d=r("el-tree"),q=r("el-card"),k=r("el-input"),h=r("el-form-item"),A=r("el-option"),S=r("el-select"),L=r("el-form"),O=r("el-dialog");return V(),w("div",ne,[l(q,null,{header:a(()=>[i("div",le,[e[6]||(e[6]=i("span",null,"组织架构",-1)),l(s,{type:"primary",onClick:M},{default:a(()=>[l(c,null,{default:a(()=>[l(x(W))]),_:1}),e[5]||(e[5]=C(" 新增部门 ",-1))]),_:1})])]),default:a(()=>[i("div",ae,[l(d,{ref:"departmentTree",data:v.value,props:B,"node-key":"id","default-expand-all":"",onNodeClick:N,onNodeContextmenu:$},{default:a(({data:o})=>[i("div",oe,[i("span",null,J(o.name),1),i("div",se,[l(s,{type:"text",size:"small",onClick:D(P=>T(o),["stop"])},{default:a(()=>[l(c,null,{default:a(()=>[l(x(K))]),_:1})]),_:1},8,["onClick"]),l(s,{type:"text",size:"small",danger:"",onClick:D(P=>U(o),["stop"])},{default:a(()=>[l(c,null,{default:a(()=>[l(x(Q))]),_:1})]),_:1},8,["onClick"])])])]),_:1},8,["data"])])]),_:1}),l(O,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),title:g.value,width:"400px",onClose:z},{footer:a(()=>[i("span",re,[l(s,{onClick:e[3]||(e[3]=o=>p.value=!1)},{default:a(()=>[...e[7]||(e[7]=[C("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:R},{default:a(()=>[...e[8]||(e[8]=[C("保存",-1)])]),_:1})])]),default:a(()=>[l(L,{ref_key:"departmentFormRef",ref:m,model:t,rules:F,"label-position":"top"},{default:a(()=>[l(h,{label:"部门名称",prop:"name"},{default:a(()=>[l(k,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),placeholder:"请输入部门名称"},null,8,["modelValue"])]),_:1}),l(h,{label:"上级部门"},{default:a(()=>[l(S,{modelValue:t.parent_id,"onUpdate:modelValue":e[1]||(e[1]=o=>t.parent_id=o),placeholder:"选择上级部门",clearable:""},{default:a(()=>[(V(!0),w(X,null,Y(E.value,o=>(V(),Z(A,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(h,{label:"部门描述"},{default:a(()=>[l(k,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=o=>t.description=o),type:"textarea",placeholder:"请输入部门描述",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ce=te(de,[["__scopeId","data-v-9799e3d6"]]);export{ce as default};
