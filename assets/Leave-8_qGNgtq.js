import{d as se,r as m,s as P,o as de,c as R,j as e,g as t,h as s,i as C,E as v,b as V,p as o,T as ue,w as re,e as pe,f as $,t as p,J as F,u as U,K as ie,F as _e,I as me,L as ve,A as fe,C as q,q as D,_ as ce}from"./index-L8zpvlSD.js";const ye={class:"leave-container"},ge={class:"card-header"},be={class:"search-form"},we={class:"pagination"},Ve={class:"dialog-footer"},ke={class:"dialog-footer"},Ye=se({__name:"Leave",setup(Ce){const S=m([]),B=m(!1),j=m(0),b=m(1),x=m(10),u=P({employee_name:"",status:"",date_range:[]}),k=m(!1),h=m(!1),M=m(!1),Y=m(),r=P({id:"",leave_type:"",start_date:"",end_date:"",reason:""}),n=m({id:"",employee_name:"",department_name:"",leave_type:"",start_date:"",end_date:"",days:0,reason:"",status:0,created_at:""}),c=async()=>{B.value=!0;try{const d={page:b.value,per_page:x.value,employee_name:u.employee_name,status:u.status,start_date:u.date_range?.[0],end_date:u.date_range?.[1]},a=await C.get("/api/leaves",{params:d});S.value=a.data.data,j.value=a.data.total}catch{v.error("获取请假列表失败")}finally{B.value=!1}},J=()=>{M.value=!1,Q(),k.value=!0},K=d=>{n.value=d,h.value=!0},O=d=>{q.prompt("请输入审批意见","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"}).then(async({value:a})=>{try{await C.put(`/api/leaves/${d.id}/approve`,{comment:a}),v.success("审批通过"),c()}catch{v.error("审批失败")}}).catch(()=>{v.info("已取消审批")})},G=d=>{q.prompt("请输入拒绝原因","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"}).then(async({value:a})=>{try{await C.put(`/api/leaves/${d.id}/reject`,{comment:a}),v.success("已拒绝"),c()}catch{v.error("操作失败")}}).catch(()=>{v.info("已取消操作")})},H=async()=>{Y.value&&await Y.value.validate(async d=>{if(d)try{M.value?(await C.put(`/api/leaves/${r.id}`,r),v.success("编辑成功")):(await C.post("/api/leaves",r),v.success("申请成功")),k.value=!1,c()}catch{v.error(M.value?"编辑失败":"申请失败")}})},Q=()=>{Y.value&&Y.value.resetFields(),Object.assign(r,{id:"",leave_type:"",start_date:"",end_date:"",reason:""})},W=()=>{b.value=1,c()},X=()=>{u.employee_name="",u.status="",u.date_range=[],b.value=1,c()},Z=d=>{x.value=d,c()},ee=d=>{b.value=d,c()};return de(()=>{c()}),(d,a)=>{const w=s("el-icon"),f=s("el-button"),E=s("el-input"),y=s("el-form-item"),g=s("el-option"),L=s("el-select"),T=s("el-date-picker"),N=s("el-form"),i=s("el-table-column"),z=s("el-tag"),ae=s("el-table"),te=s("el-pagination"),le=s("el-card"),A=s("el-dialog"),_=s("el-descriptions-item"),oe=s("el-descriptions"),ne=pe("loading");return D(),R("div",ye,[e(le,null,{header:t(()=>[V("div",ge,[a[14]||(a[14]=V("span",null,"请假审批",-1)),e(f,{type:"primary",onClick:J},{default:t(()=>[e(w,null,{default:t(()=>[e(U(fe))]),_:1}),a[13]||(a[13]=o(" 申请请假 ",-1))]),_:1})])]),default:t(()=>[V("div",be,[e(N,{inline:!0,model:u,class:"demo-form-inline"},{default:t(()=>[e(y,{label:"员工姓名"},{default:t(()=>[e(E,{modelValue:u.employee_name,"onUpdate:modelValue":a[0]||(a[0]=l=>u.employee_name=l),placeholder:"请输入员工姓名"},null,8,["modelValue"])]),_:1}),e(y,{label:"状态"},{default:t(()=>[e(L,{modelValue:u.status,"onUpdate:modelValue":a[1]||(a[1]=l=>u.status=l),placeholder:"请选择状态"},{default:t(()=>[e(g,{label:"全部",value:""}),e(g,{label:"待审批",value:0}),e(g,{label:"已通过",value:1}),e(g,{label:"已拒绝",value:2})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"日期范围"},{default:t(()=>[e(T,{modelValue:u.date_range,"onUpdate:modelValue":a[2]||(a[2]=l=>u.date_range=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(y,null,{default:t(()=>[e(f,{type:"primary",onClick:W},{default:t(()=>[...a[15]||(a[15]=[o("查询",-1)])]),_:1}),e(f,{onClick:X},{default:t(()=>[...a[16]||(a[16]=[o("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),e(ue,{name:"fade",mode:"out-in"},{default:t(()=>[re((D(),$(ae,{data:S.value,border:"",stripe:"",style:{width:"100%"},key:"leave-table-"+Date.now()},{default:t(()=>[e(i,{prop:"id",label:"ID",width:"80"}),e(i,{prop:"employee_name",label:"员工姓名"}),e(i,{prop:"department_name",label:"部门"}),e(i,{prop:"leave_type",label:"请假类型",width:"100"},{default:t(l=>[e(z,{type:l.row.leave_type==="annual"?"primary":l.row.leave_type==="sick"?"warning":"info"},{default:t(()=>[o(p(l.row.leave_type==="annual"?"年假":l.row.leave_type==="sick"?"病假":"事假"),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"start_date",label:"开始日期",width:"120"}),e(i,{prop:"end_date",label:"结束日期",width:"120"}),e(i,{prop:"days",label:"天数",width:"80"}),e(i,{prop:"reason",label:"原因",width:"200","show-overflow-tooltip":""}),e(i,{prop:"status",label:"状态",width:"100"},{default:t(l=>[e(z,{type:l.row.status===0?"warning":l.row.status===1?"success":"danger"},{default:t(()=>[o(p(l.row.status===0?"待审批":l.row.status===1?"已通过":"已拒绝"),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"created_at",label:"申请时间",width:"160"}),e(i,{label:"操作",width:"200",fixed:"right"},{default:t(l=>[e(f,{size:"small",type:"primary",onClick:I=>K(l.row)},{default:t(()=>[e(w,null,{default:t(()=>[e(U(ie))]),_:1}),a[17]||(a[17]=o(" 查看 ",-1))]),_:1},8,["onClick"]),l.row.status===0?(D(),R(_e,{key:0},[e(f,{size:"small",type:"success",onClick:I=>O(l.row)},{default:t(()=>[e(w,null,{default:t(()=>[e(U(me))]),_:1}),a[18]||(a[18]=o(" 通过 ",-1))]),_:1},8,["onClick"]),e(f,{size:"small",type:"danger",onClick:I=>G(l.row)},{default:t(()=>[e(w,null,{default:t(()=>[e(U(ve))]),_:1}),a[19]||(a[19]=o(" 拒绝 ",-1))]),_:1},8,["onClick"])],64)):F("",!0)]),_:1})]),_:1},8,["data"])),[[ne,B.value]])]),_:1}),V("div",we,[e(te,{"current-page":b.value,"onUpdate:currentPage":a[3]||(a[3]=l=>b.value=l),"page-size":x.value,"onUpdate:pageSize":a[4]||(a[4]=l=>x.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:j.value,onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),_:1}),e(A,{modelValue:k.value,"onUpdate:modelValue":a[10]||(a[10]=l=>k.value=l),title:M.value?"编辑请假":"申请请假",width:"500px"},{footer:t(()=>[V("span",Ve,[e(f,{onClick:a[9]||(a[9]=l=>k.value=!1)},{default:t(()=>[...a[20]||(a[20]=[o("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:H},{default:t(()=>[...a[21]||(a[21]=[o("确定",-1)])]),_:1})])]),default:t(()=>[e(N,{ref_key:"leaveForm",ref:Y,model:r,"label-width":"100px",rules:"rules"},{default:t(()=>[e(y,{label:"请假类型",prop:"leave_type"},{default:t(()=>[e(L,{modelValue:r.leave_type,"onUpdate:modelValue":a[5]||(a[5]=l=>r.leave_type=l),placeholder:"请选择请假类型"},{default:t(()=>[e(g,{label:"年假",value:"annual"}),e(g,{label:"病假",value:"sick"}),e(g,{label:"事假",value:"personal"})]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"开始日期",prop:"start_date"},{default:t(()=>[e(T,{modelValue:r.start_date,"onUpdate:modelValue":a[6]||(a[6]=l=>r.start_date=l),type:"date",placeholder:"选择开始日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(y,{label:"结束日期",prop:"end_date"},{default:t(()=>[e(T,{modelValue:r.end_date,"onUpdate:modelValue":a[7]||(a[7]=l=>r.end_date=l),type:"date",placeholder:"选择结束日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(y,{label:"原因",prop:"reason"},{default:t(()=>[e(E,{modelValue:r.reason,"onUpdate:modelValue":a[8]||(a[8]=l=>r.reason=l),type:"textarea",placeholder:"请输入请假原因",rows:4},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(A,{modelValue:h.value,"onUpdate:modelValue":a[12]||(a[12]=l=>h.value=l),title:"请假详情",width:"500px"},{footer:t(()=>[V("span",ke,[e(f,{onClick:a[11]||(a[11]=l=>h.value=!1)},{default:t(()=>[...a[22]||(a[22]=[o("关闭",-1)])]),_:1})])]),default:t(()=>[e(oe,{column:1,border:""},{default:t(()=>[e(_,{label:"员工姓名"},{default:t(()=>[o(p(n.value.employee_name),1)]),_:1}),e(_,{label:"部门"},{default:t(()=>[o(p(n.value.department_name),1)]),_:1}),e(_,{label:"请假类型"},{default:t(()=>[e(z,{type:n.value.leave_type==="annual"?"primary":n.value.leave_type==="sick"?"warning":"info"},{default:t(()=>[o(p(n.value.leave_type==="annual"?"年假":n.value.leave_type==="sick"?"病假":"事假"),1)]),_:1},8,["type"])]),_:1}),e(_,{label:"开始日期"},{default:t(()=>[o(p(n.value.start_date),1)]),_:1}),e(_,{label:"结束日期"},{default:t(()=>[o(p(n.value.end_date),1)]),_:1}),e(_,{label:"天数"},{default:t(()=>[o(p(n.value.days),1)]),_:1}),e(_,{label:"原因"},{default:t(()=>[o(p(n.value.reason),1)]),_:1}),e(_,{label:"状态"},{default:t(()=>[e(z,{type:n.value.status===0?"warning":n.value.status===1?"success":"danger"},{default:t(()=>[o(p(n.value.status===0?"待审批":n.value.status===1?"已通过":"已拒绝"),1)]),_:1},8,["type"])]),_:1}),e(_,{label:"申请时间"},{default:t(()=>[o(p(n.value.created_at),1)]),_:1}),n.value.status!==0?(D(),$(_,{key:0,label:"审批意见"},{default:t(()=>[o(p(n.value.approval_comment||"无"),1)]),_:1})):F("",!0),n.value.status!==0?(D(),$(_,{key:1,label:"审批时间"},{default:t(()=>[o(p(n.value.updated_at),1)]),_:1})):F("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),xe=ce(Ye,[["__scopeId","data-v-d884fdb1"]]);export{xe as default};
